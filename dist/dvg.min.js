var dvg=function(t){"use strict";var e;!function(t){t[t.String=0]="String",t[t.Number=1]="Number",t[t.Date=2]="Date"}(e||(e={}));const s=/{{([^}]+)}}/g,n=/_x([0-9A-Za-z]+)_/g,i=/(?:^|,)(\w+)(?:$|,)/g,a=/([^:,]+)/g,r=/^[-+]?[0-9]*\.?[0-9]+$/g,o=/^[@#$][0-9]+$/g,l=[" ","-","_"],m={"@":e.String,"#":e.Number,$:e.Date};function c(t){return"{"+t.replace(i,(function(t,e){return t.replace(e,u(e,l)+":true")})).replace(a,(function(t,e){return"true"===t||"false"===t||r.test(t)?u(t,l):'"'+u(t,l)+'"'}))+"}"}function u(t,e){for(var s=0,n=t.length;s<n&&e.indexOf(t[s])>=0;)++s;for(;n>s&&e.indexOf(t[n-1])>=0;)--n;return s>0||n<t.length?t.substring(s,n):t}function h(t){let e={name:"",opts:{}};const n=t.match(s);if(n)if((t=n[0].slice(2,-2)).includes("|")){const s=t.split("|");e.name=u(s[0],l),e.opts=JSON.parse(c(s[1]))}else t.includes(":")?e.opts=JSON.parse(c(t)):e.name=u(t,l);return e}function f(t,e){return Array.from(t.querySelectorAll("*[id]")).filter((t=>t.id?.match(s))).filter((function(t){let s=h(t.id);for(let t in s.opts)if(e.includes(t))return!0;return!1}))}function p(t){let e;if((t=t.replace(/_/g," ")).includes("..")?e="..":t.includes("to")?e="to":t.includes(";")&&(e=";"),!e)return{0:Number(t.trim()),1:void 0};{let s=t.split(e);if(s=";"===e?s.map((t=>u(t,l))):s.map((function(t){for(;t.includes("--");)t=t.replace("--","-");return"-"===t.charAt(t.length-1)&&(t=t.substr(0,t.length-1)),t})),s.length>1)return{0:Number(s[0].trim()),1:Number(s[1].trim())}}return{0:void 0,1:void 0}}function g(t,e){for(let s of e)if(t.hasOwnProperty(s))return s}function _(t,e){const s=function(t){if(t.match(o)){const e=t.charAt(0),s=t.substring(1);if(m.hasOwnProperty(e))return[m[e],Number.parseInt(s)]}}(t);let n;if(s){const[t,i]=s;n=e.getColumn(i,t)}else n=e.getColumn(t);return n}class d{constructor(t){this.element=t,this.opts=h(t.id).opts}static getDynamics(t){return[]}apply(t,e){}}class y extends d{constructor(t){super(t),this.template=this.element.textContent;const e=this.element,s=e.getBBox();let n,i=g(this.opts,["align","a"]);if(i)n=this.opts[i].toString();else{const t=this.element.parentElement;if(t){const e=h(t.id)?.opts;e&&(i=g(e,["align","a"]),i&&(n=e[i].toString()))}}if(void 0!==n)switch(e.setAttribute("text-anchor",n),n){case"start":break;case"middle":e.setAttribute("x",s.x+s.width/2+"px");break;case"end":e.setAttribute("x",s.x+s.width+"px")}}static getDynamics(t){let e=[];return t.querySelectorAll("text").forEach((function(t){t.children.length?e.push(...t.children):e.push(t)})),e=e.filter((t=>t.textContent&&t.textContent.match(s))),e.map((t=>new y(t)))}apply(t,e){this.template&&(this.element.textContent=this.template.replace(s,function(e){const s=h(e),n=_(s.name,t);if(n){const e=g(s.opts,["name","n"]);if(e&&s.opts[e])return n.name;{const e=g(s.opts,["compact","c"]);return e&&s.opts[e]?t.getFormatted(0,n.name,!0):t.getFormatted(0,n.name)}}return"???"}.bind({data:t})))}}function b(t,e=!0){const s=document.createElementNS("http://www.w3.org/2000/svg","g");if(t.insertAdjacentElement("afterend",s),s.append(t),e){t.classList.length>0&&(s.classList.add(...t.classList),t.classList.remove(...t.classList)),t.style.cssText&&(s.style.cssText=t.style.cssText,t.style.cssText="");const e=t.getAttribute("clip-path");e&&(s.setAttribute("clip-path",e),t.removeAttribute("clip-path"))}return s}function x(t,e=["all"]){(e.includes("all")||e.includes("text"))&&t.querySelectorAll("tspan").forEach((function(t){t.parentElement&&t.parentElement.hasAttribute("x")&&t.removeAttribute("x"),t.parentElement&&t.parentElement.hasAttribute("y")&&t.removeAttribute("y")})),(e.includes("all")||e.includes("decode"))&&t.querySelectorAll("*[id]").forEach((function(t){t.id=t.id.replace(n,(function(t,e){return String.fromCharCode(parseInt("0x"+e))}))}))}class v{constructor(t){this._begT=0,this._curT=0,this._endT=1,this._begTime=void 0,this._frameRequestId=0,this.step=t=>{void 0===this._begTime&&(this._begTime=t);const e=t-this._begTime,s=e/1e3,n=s<.5?4*s*s*s:1-Math.pow(-2*s+2,3)/2;this._curT=this._begT+n*(this._endT-this._begT),this._callback&&this._callback(this._curT),e<1e3&&(this._frameRequestId=window.requestAnimationFrame(this.step))},this._callback=t}get curT(){return this._curT}ease(t=0,e=1){this._frameRequestId&&window.cancelAnimationFrame(this._frameRequestId),this._begT=t,this._endT=e,this._begTime=void 0,this._frameRequestId=window.requestAnimationFrame(this.step)}}class w{constructor(t){switch(this.element=t,this.tag=this.element.tagName,this.tag){case"polyline":case"path":this.linear=!1;break;default:this.linear=!0}}get(t){switch(this.tag){case"polyline":case"path":case"line":const e=this.element;let s=e.getPointAtLength(e.getTotalLength()*t),n=e.getPointAtLength(0);return{x:s.x-n.x,y:s.y-n.y};default:const i=this.element.getBBox();return{x:i.width*t,y:i.height*t}}}}class N extends d{constructor(t){super(t),this.base_transforms=[],this.guide=void 0,this.nonlinear_pos_easer=new v(this.setNonlinearPosition.bind(this));const e=this.element;this.bbox=e.getBBox(),this.origin=this.getOrigin(),this.base_transforms=function(t){let e=[];if(t.transform.baseVal.numberOfItems>0)for(let s=0;s<t.transform.baseVal.numberOfItems;s+=1){const n=t.transform.baseVal.getItem(s);e.push("matrix("+n.matrix.a+","+n.matrix.b+","+n.matrix.c+","+n.matrix.d+","+n.matrix.e+","+n.matrix.f+")")}return e}(e),b(e),this.nonlinear_pos_group=b(e),e.setAttribute("vector-effect","non-scaling-stroke");let s=[];s.concat(...e.style.transitionProperty.split(",")),s.push("transform"),e.style.transitionProperty=s.join(","),e.style.transitionDuration="1s",e.style.transitionTimingFunction="cubic-bezier(0.25, .1, 0.25, 1)",e.style.transformOrigin=this.origin.x+"px "+this.origin.y+"px"}static getDynamics(t){return f(t,[].concat(...N.transforms.map((t=>t.keys)))).map((t=>new N(t)))}getOrigin(){let t={x:0,y:0};const e=g(this.opts,["origin","o"]);if(e){const s=p(this.opts[e]?.toString());void 0!==s[1]?(t.x=s[0],t.y=s[1]):void 0!==s[0]&&(t.x=t.y=s[0])}return function(t,e){const s=t.getBBox();return{x:s.x+s.width*e.x,y:s.y+s.height*e.y}}(this.element,t)}apply(t,e){const s=this.element,n=g(this.opts,["guide","g"]);n&&!this.guide&&(this.guide=new w(e.refs.get(this.opts[n].toString())));let i=[];this.base_transforms.length>0&&(i.push("translate("+-this.origin.x+"px,"+-this.origin.y+"px)"),i.push(...this.base_transforms),i.push("translate("+this.origin.x+"px,"+this.origin.y+"px)"));const a=N.transforms.filter((t=>t.keys[0].startsWith("p"))).map((t=>t.keys)).flat().filter((t=>t.startsWith("p")));for(let e of N.transforms){const s=g(this.opts,e.keys);if(s){const n=_(this.opts[s].toString(),t);if(n?.stats){const r=t.get(0,n.name);if(void 0!==r){const t=(r-n.stats.min)/(n.stats.max-n.stats.min);this.guide?i.push(e.get(t,this.opts,this.guide)):i.push(e.get(t,this.opts)),a.includes(s)&&this.guide&&!this.guide.linear&&this.nonlinear_pos_easer.ease(this.nonlinear_pos_easer.curT,t)}}}}s.style.transform=i.join(" ")}setNonlinearPosition(t){if(this.guide){const e=this.guide.get(t);this.nonlinear_pos_group.style.transform="translate("+e.x+"px,"+e.y+"px)"}}}N.transforms=[{keys:["scale","s"],get:function(t,e,s){return"scale("+t+","+t+")"}},{keys:["scaleX","sx"],get:function(t,e,s){return"scaleX("+t+")"}},{keys:["scaleY","sy"],get:function(t,e,s){return"scaleY("+t+")"}},{keys:["rotate","r"],get:function(t,e,s){let n=1;const i=g(e,["rotateRatio","rr"]);return i&&(n=Number(e[i])),"rotate("+360*t*n+"deg)"}},{keys:["position","p"],get:function(t,e,s){if(s&&s.linear){const e=s.get(t);return"translate("+e.x+"px,"+e.y+"px)"}return""}},{keys:["positionX","px"],get:function(t,e,s){if(s&&s.linear){return"translateX("+s.get(t).x+"px)"}return""}},{keys:["positionY","py"],get:function(t,e,s){if(s&&s.linear){return"translateY("+s.get(t).y+"px)"}return""}}];class S extends d{constructor(t){super(t),this.baseAlpha=1;const e=this.element;let s=e.style.transitionProperty.split(",");s.push("fill"),s.push("stroke"),s.push("opacity"),console.log(s),e.style.transitionProperty=s.join(","),e.style.transitionDuration="1s",this.setBaseStyles()}static getDynamics(t){return f(t,[].concat(...S.styles.map((t=>t.keys)))).map((t=>new S(t)))}setBaseStyles(){const t=this.element;t.hasAttribute("opacity")&&(this.baseAlpha=Number(t.getAttribute("opacity")))}apply(t,e){const s=this.element;for(let e of S.styles){const n=g(this.opts,e.keys);if(n){const i=_(this.opts[n].toString(),t);if(i?.stats){const n=t.get(0,i.name);if(void 0!==n){const t=(n-i.stats.min)/(i.stats.max-i.stats.min);e.set(s,t,this)}}}}}}S.styles=[{keys:["fill","f"],set:function(t,e,s){t.style.fill="#ff0000"}},{keys:["line","l"],set:function(t,e,s){t.style.stroke="#ff0000"}},{keys:["alpha","a"],set:function(t,e,s){t.style.opacity=(s.baseAlpha*e).toString()}}];const C={DOLLAR:"NLMNLUSD",EURO:"NLMNLEUR",POUND:"NLMNLGBP",WON:"NLMNLCNY",YEN:"NLMNLJPY"},A="???";function L(t){var e=(t=Math.round(t))%3600,s=e%60;return{h:Math.floor(t/3600),m:Math.floor(e/60),s:Math.ceil(s)}}const k=t=>"number"==typeof t?new Intl.NumberFormat(navigator.language).format(t):""+t,M=function(t){return"number"==typeof t?new Intl.NumberFormat(navigator.language,{notation:"compact",maximumSignificantDigits:3}).format(t):""+t};function F(t){if(void 0!==t.name){let e={maximumFractionDigits:t.precision,minimumFractionDigits:t.precision},s={maximumFractionDigits:t.precision,minimumFractionDigits:t.precision,notation:"compact",maximumSignificantDigits:3};for(let e in C)t.name===e&&(t.name=C[e]);if(t.name.startsWith("NLMNI")){const n=t.name.replace("NLMNI","");return{format:t=>{if("number"==typeof t)return n+new Intl.NumberFormat(navigator.language,e).format(t)},compactFormat:t=>{if("number"==typeof t)return n+new Intl.NumberFormat(navigator.language,s).format(t)}}}return t.name.startsWith("TIME")?{format:t=>{if("number"==typeof t){const e=L(t);return(""+e.h).padStart(2,"0")+":"+(""+e.m).padStart(2,"0")+":"+(""+e.s).padStart(2,"0")}return A},compactFormat:function(t){return this.format(t)}}:t.name.startsWith("HOUR")?{format:t=>{if("number"==typeof t){const e=Math.floor(t/3600);return new Intl.NumberFormat(navigator.language).format(e)}return A},compactFormat:function(t){return this.format(t)}}:t.name.startsWith("HHMM")?{format:t=>{if("number"==typeof t){const e=L(t);return(""+e.h).padStart(2,"0")+":"+(""+e.m).padStart(2,"0")}return A},compactFormat:function(t){return this.format(t)}}:t.name.startsWith("MMSS")?{format:t=>{if("number"==typeof t){const e=Math.round(t),s=Math.floor(e/60),n=Math.ceil(e%3600%60);return(""+s).padStart(2,"0")+":"+(""+n).padStart(2,"0")}return A},compactFormat:function(t){return this.format(t)}}:(t.name.startsWith("NLMNL")?(e.style="currency",e.currency=t.name.replace("NLMNL","")):t.name.startsWith("PERCENT")?e.style="percent":t.name.startsWith("F")?e.useGrouping=!1:t.name.startsWith("BEST")&&(delete e.maximumFractionDigits,e.maximumSignificantDigits=t.width,s.maximumSignificantDigits=3),{format:t=>"number"==typeof t?new Intl.NumberFormat(navigator.language,e).format(t):A,compactFormat:function(t){return"number"==typeof t?new Intl.NumberFormat(navigator.language,s).format(t):A}})}return{format:t=>"string"==typeof t?t:A,compactFormat:function(t){return this.format(t)}}}class T{constructor(t,e){this._values=[],this._cols_map=new Map;for(let s=0;s<e.length;s+=1)s<t.length&&(this._values.push(t[s]),this._cols_map.set(e[s],s))}get(t){if("string"!=typeof t)return this._values[t];if(this._cols_map.has(t)){const e=this._cols_map.get(t);if(null!=e)return this._values[e]}}set(t,e){if("string"==typeof t){if(this._cols_map.has(t)){const s=this._cols_map.get(t);null!=s&&(this._values[s]=e)}}else this._values[t]=e}delete(t){if("string"==typeof t){if(this._cols_map.has(t)){const e=this._cols_map.get(t);if(null!=e){this._values.splice(e,1);for(let[t,s]of this._cols_map)s>e&&this._cols_map.set(t,s-1);this._cols_map.delete(t)}}}else if(t>=0&&t<this._values.length){this._values.splice(t,1);const e=Array.from(this._cols_map.keys())[t];for(let[e,s]of this._cols_map)s>t&&this._cols_map.set(e,s-1);this._cols_map.delete(e)}}renameColumn(t,e){if("string"==typeof t){const s=this._cols_map.get(t);void 0!==s&&(this._cols_map.set(e,s),this._cols_map.delete(t))}else{const s=Array.from(this._cols_map.keys())[t];this._cols_map.set(e,t),this._cols_map.delete(s)}}}class D{constructor(t){if(this._rows=[],this._cols=[],this._cols_map=new Map,"string"==typeof t);else{for(let e of t.values)this._rows.push(new T(e,t.columns));let n=[];if(t.values[0]&&(n=t.values[0].map((t=>typeof t))),this._cols=t.columns.map(((t,s)=>({name:t,type:"string"===n[s]?e.String:e.Number}))),t.columns.forEach(((t,e)=>this._cols_map.set(t,e))),void 0!==t.formats)for(let e=0;e<t.columns.length;e+=1)if(e<t.formats.length){const s=t.columns[e];this.setColumnFormat(s,F(t.formats[e]))}this.calcColumnStats(),function(t){for(let e of t.cols){const n=e.match(s);if(n){const i=t.getColumn(e);if(i){const a=h(e).name.toLowerCase(),r=e.replace(s,"").trim(),o=p(n[0].slice(2,-2));if(void 0!==o[1]){const e=Number(o[0]),s=Number(o[1]);t.renameColumn(i.name,r),t.setColumnStats(r,{min:e,max:s})}else{const e=t.getColumn(r);if(e){switch(a){case"min":t.setColumnStats(e.name,{min:i.stats?.min});break;case"max":t.setColumnStats(e.name,{max:i.stats?.max});break;case"sum":t.setColumnStats(e.name,{sum:i.stats?.sum});break;case"avg":t.setColumnStats(e.name,{avg:i.stats?.avg})}t.dropColumn(i.name)}}}}}}(this)}}get cols(){return Array.from(this._cols_map.keys())}get rows(){return this._rows}get(t,e){const s=this._rows[t],n=this.getColumn(e);if(s&&n)return s.get(n.name)}set(t,e,s){if(t<this._rows.length){const n=this._rows[t],i=this.getColumn(e);i&&n.set(i.name,s)}}getColumn(t,e){if(void 0===e){if("string"!=typeof t)return this._cols[t];if(this._cols_map.has(t)){const e=this._cols_map.get(t);if(null!=e)return this._cols[e]}}else if("number"==typeof t){return this._cols.filter((t=>t.type===e))[t]}}renameColumn(t,e){const s=this.getColumn(t);if(s){const n=this._cols_map.get(s.name);if(void 0!==n){for(let s of this._rows)s.renameColumn(t,e);this._cols_map.set(e,n),this._cols_map.delete(s.name),s.name=e}}}getRow(t){if(t<this._rows.length)return this._rows[t]}getFormatted(t,e,s=!1){const n=this.getColumn(e);if(n){const e=this.get(t,n.name);if(console.log(e),void 0!==e)return n.format?s?n.format.compactFormat(e):n.format.format(e):s?M(e):k(e)}return"???"}setColumnFormat(t,e){const s=this.getColumn(t);s&&(s.format=e)}setColumnFormats(t,e){for(let s=0;s<t.length;s+=1)s<e.length&&this.setColumnFormat(t[s],e[s])}min(t){return this.getColumn(t)?.stats?.min}max(t){return this.getColumn(t)?.stats?.max}sum(t){return this.getColumn(t)?.stats?.sum}avg(t){return this.getColumn(t)?.stats?.avg}calcColumnStats(t=[]){t.length<=0&&(t=this._cols.map((t=>t.name)));const s=this._cols.filter((s=>{return t.includes(s.name)&&s.type===e.Number&&!((n=s).stats&&n.stats.manual&&!0===n.stats.manual);var n}));s.forEach((t=>t.stats={min:Number.MAX_VALUE,max:Number.MIN_VALUE,sum:0,avg:0}));for(let t of this._rows)for(let e of s)if(e&&e.stats){const s=t.get(e.name);s<e.stats.min&&(e.stats.min=s),s>e.stats.max&&(e.stats.max=s),e.stats.sum+=s}for(let t of s)t&&t.stats&&(t.stats.avg=t.stats.sum/this._rows.length)}setColumnStats(t,e){const s=this.getColumn(t);s&&(s.stats||(s.stats={min:Number.MAX_VALUE,max:Number.MIN_VALUE,sum:0,avg:0}),void 0!==e.min&&(s.stats.min=e.min),void 0!==e.max&&(s.stats.max=e.max),void 0!==e.sum&&(s.stats.sum=e.sum),void 0!==e.avg&&(s.stats.avg=e.avg),s.stats.manual=!0)}dropColumn(t){const e=this.getColumn(t);if(e){for(const t of this._rows)t.delete(e.name);const t=this._cols_map.get(e.name);if(null!=t)for(let[e,s]of this._cols_map)s>t&&this._cols_map.set(e,s-1);this._cols_map.delete(e.name),this._cols=this._cols.filter((t=>t.name!==e.name))}}castColumn(t,s){const n=this.getColumn(t);if(n)switch(n.type=s,s){case e.String:for(let t of this._rows)t.set(n.name,String(t.get(n.name)));break;case e.Number:for(let t of this._rows)t.set(n.name,Number(t.get(n.name)));this.calcColumnStats([n.name]);break;case e.Date:}}}class E{constructor(t,e){this.data=new D(""),this.refs=new Map,this.initComplete=!1,this.dynamics=[],this.element=t,this.opts={svg:"index.svg",clean:"all",dynamics:"all"},this.opts={...this.opts,...e},this.init()}init(){"svg"===this.element.tagName.toLowerCase()?this.initSVG(this.element):(this.element.style.opacity="0",fetch(this.opts.svg.toString(),{method:"GET"}).then((t=>t.text())).then((t=>{const e=this.element;e.innerHTML=t;const s=e.querySelector("svg");s&&this.initSVG(s),e.style.transition="opacity 0.5s ease 1s",e.style.opacity="1"})).catch((t=>console.error("Error: ",t))))}initSVG(t){x(t,this.opts.clean.toString().split(","));const e=document.createElementNS("http://www.w3.org/2000/svg","g");e.classList.add("__instance__"),e.id="__instance_0001__",e.append(...[...t.children].filter((t=>"style"!==t.tagName))),t.append(e),this.refs=function(t){const e=new Map;return Array.from(t.querySelectorAll("*[id]")).filter((t=>t.id?.match(s))).forEach((function(t){let s=h(t.id);s.name&&e.set(s.name,t)})),e}(t),this.dynamics=E.getDynamics(e),this.initComplete=!0}static getDynamics(t,e=["all"]){let s=[];return(e.includes("all")||e.includes("text"))&&s.push(...y.getDynamics(t)),(e.includes("all")||e.includes("transforms"))&&s.push(...N.getDynamics(t)),(e.includes("all")||e.includes("styles"))&&s.push(...S.getDynamics(t)),s}apply(){this.initComplete?this.dynamics.forEach((t=>t.apply(this.data,this))):window.setTimeout(this.apply.bind(this),100)}draw(){}update(t){this.data=new D(t),this.apply()}}return t.DVG=E,t.Data=D,Object.defineProperty(t,"__esModule",{value:!0}),t}({});
